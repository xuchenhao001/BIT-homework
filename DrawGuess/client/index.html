<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>webchat</title>

	<!-- Bootstrap -->
    <link rel="stylesheet" href="css/bootstrap.min.css" media="screen">
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <!--Messenger-->
    <link rel="stylesheet" href="css/messenger.css">
    <link rel="stylesheet" href="css/messenger-theme-air.css">
    <script src="js/messenger.min.js"></script>

    <!--Web socket-->
	<script src="/socket.io/socket.io.js"></script>
</head>
<body>
<!-- container -->
<div class="container">
    <input id="username" type="text" class="form-control" placeholder="Username">
    <input id="roomID" type="text" class="form-control" placeholder="Room number">
    <button id="selectRoomBtn" type="button" class="btn btn-lg btn-primary">进入房间</button>
    <br/>
    <input id="messages" type="text" class="form-control" placeholder="Messages">
	<button id="sendBtn" type="button" class="btn btn-lg btn-primary">发送消息</button>
    <br/>
    <button id="exitBtn" type="button" class="btn btn-lg btn-primary">退出房间</button>

</div>

<script type="text/javascript">
    var socket = io();
    var	sendMessageBtn = document.getElementById('sendBtn');
    var selectRoomBtn = document.getElementById('selectRoomBtn');

    var roomID = "foo";
    var username = "nobody";

    Messenger.options = {
        extraClasses: 'messenger-fixed messenger-on-bottom',
        theme: 'air'
    };
    msg = Messenger().post({
        message: "Your request has succeed!",
        hideAfter: 3
    });

    selectRoomBtn.onclick = function () {
        var inputUsername = document.getElementById('username').value;
        if (inputUsername.length>0 && inputUsername!=="system"){
            username = inputUsername;
        }
        var inputRoomID = document.getElementById('roomID').value;
        if (inputRoomID.length>0 && inputRoomID!=="__system"){
            roomID = inputRoomID;
        }
        else roomID = "foo";
        console.log(roomID);
        socket.emit("__connect", roomID, username);
    };
    sendMessageBtn.onclick = function(){
        var message = document.getElementById('messages').value;
        socket.emit("__message", roomID, username, message);
    };

    socket.on('__message', function (message) {
        msg.update(message);
    });
</script>
</body>
</html>